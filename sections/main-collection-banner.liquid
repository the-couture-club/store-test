{%- liquid
  assign collection_has_image = false
  if collection.metafields.custom.collection_banner != null and section.settings.show_collection_image
    assign collection_has_image = true
  endif
-%}
<style>
.section--{{ section.id }} .collection__header-media-overlay:before,
.section--{{ section.id }} .collection__header-media-overlay:before {
    background: {{ section.settings.overlay_color }};
    {% if section.settings.overlay_strength == 100 %}
        opacity: 1;
    {% else %}
        opacity: .{{ section.settings.overlay_strength }};
    {% endif %}
}
</style>

<section class="section section--mb-0 section--{{ section.id }} section--full" data-section-id="{{ section.id }}" data-section-type="collection-template">

    <div class="collection js-collection-banner collection--img {% if section.settings.center_title %} collection--center{% endif %}"  data-collection-has-image="{{ collection_has_image }}">
        
        <div class="collection__header collection__header--img">
            {% if collection.metafields.custom.collection_banner != null and section.settings.show_collection_image %}
                <div class="collection__header-media o-ratio o-ratio--{{ section.settings.collection_image_height }}{% if section.settings.collection_image_mobile_height %} collection__header-media--mobile-height{% endif %}" style="background-image: url('{{ collection.metafields.custom.collection_banner.value | img_url: '1x1' }}')">
                    <img
                        class="collection__header-img collection__header-img--{{ section.id }}"
                        src="{{ collection.metafields.custom.collection_banner.value | img_url: '600x' }}"
                        srcset="{% render 'bgset', image: collection.metafields.custom.collection_banner.value %}"
                        width="600"
                        height="{{ 600 | divided_by: collection.metafields.custom.collection_banner.value.aspect_ratio | round }}"
                        sizes="100vw"
                        alt="{{  collection.title }}"
                        loading="eager"
                    />
                    <div class="collection__header-media-overlay u-bg-overlay"></div>
                </div>
            {% else %}
                <div class="collection__header-media o-ratio o-ratio--{{ section.settings.collection_image_height }}{% if section.settings.collection_image_mobile_height %} collection__header-media--mobile-height{% endif %}" style="background-image: url('{{ section.settings.fallback_image | img_url: '1x1' }}')">
                    <img
                        class="collection__header-img collection__header-img--{{ section.id }}"
                        src="{{ section.settings.fallback_image | img_url: '600x' }}"
                        srcset="{% render 'bgset', image: section.settings.fallback_image %}"
                        width="600"
                        height="{{ 600 | divided_by: section.settings.fallback_image.aspect_ratio | round }}"
                        sizes="100vw"
                        alt="{{ collection.title }}"
                        loading="eager"
                    />
                    <div class="collection__header-media-overlay u-bg-overlay"></div>
                </div>
            {% endif %}
        <div class="collection__header-info" data-align="{{collection.metafields.custom.collection_title_alignment.value | downcase}}" style="color: {% unless collection.metafields.custom.collection_title_colour != null %}{{ section.settings.title_colour }}{%else%}{{collection.metafields.custom.collection_title_colour}}{% endunless %};">
                <div class="section__title collection__header-info__title{% if section.settings.center_title %} section__title--center{% endif %}">
                    <h1 class="section__title-text collection__header-info__title-text">{{ collection.title }}</h1>
                </div>
            </div>
        </div>

    </div>
</section> 

{% unless section.settings.show_collection_image %}
    <script>
        document.querySelector('.js-header').setAttribute('data-transparent-header', false)
    </script>
{% endunless %}

{% schema %}
{
    "name": "Collection banner",
    "class": "js-section__collection-banner",
    "settings": [
        {
            "type": "checkbox",
            "id": "center_title",
            "label": "Center heading and text",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "show_collection_image",
            "label": "Show image",
            "default": true
        },
        {
            "type": "image_picker",
            "id": "fallback_image",
            "label": "Fallback Banner"
        },
        {
            "type": "color",
            "id": "title_colour",
            "label": "Fallback Title color",
            "default": "#000000"
        },
        {
            "type": "select",
            "id": "collection_image_height",
            "label": "Image height",
            "default": "4:1",
            "options": [
                {
                    "label": "Small",
                    "value": "4:1"
                },
                {
                    "label": "Medium",
                    "value": "3:1"
                },
                {
                    "label": "Large",
                    "value": "5:2"
                },
                {
                    "label": "Extra large",
                    "value": "16:9"
                }
            ]
        },
        {
            "type": "checkbox",
            "id": "collection_image_mobile_height",
            "label": "Increase image height on mobile",
            "default": true
        },
        {
            "type": "color",
            "id": "overlay_color",
            "label": "Overlay color",
            "default": "#000000"
        },
        {
            "type": "range",
            "id": "overlay_strength",
            "label": "Overlay strength",
            "unit": "%",
            "min": 0,
            "max": 100,
            "step": 10,
            "default": 0
        }
    ]
}
{% endschema %}
